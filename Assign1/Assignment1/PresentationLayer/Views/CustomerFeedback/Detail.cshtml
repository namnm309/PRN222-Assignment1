@model BusinessLayer.ViewModels.FeedbackViewModel
@{
    ViewData["Title"] = "Chi tiết phản hồi";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-comment-dots mr-2"></i>Chi tiết phản hồi
                    </h3>
                    <div class="card-tools">
                        <a href="@Url.Action("Index")" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </a>
                        <a href="@Url.Action("Reply", new { id = Model.Id })" class="btn btn-primary">
                            <i class="fas fa-reply"></i> Trả lời
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <!-- Feedback Content -->
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-user mr-2"></i>Thông tin khách hàng
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Tên khách hàng:</strong> @Model.CustomerName</p>
                                            @if (!string.IsNullOrEmpty(Model.CustomerEmail))
                                            {
                                                <p><strong>Email:</strong> @Model.CustomerEmail</p>
                                            }
                                            @if (!string.IsNullOrEmpty(Model.CustomerPhone))
                                            {
                                                <p><strong>Số điện thoại:</strong> @Model.CustomerPhone</p>
                                            }
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Ngày gửi:</strong> @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p>
                                            <p><strong>ID phản hồi:</strong> @Model.Id</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Product Information -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-car mr-2"></i>Thông tin sản phẩm
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Tên sản phẩm:</strong> @Model.ProductName</p>
                                    <p><strong>ID sản phẩm:</strong> @Model.ProductId</p>
                                </div>
                            </div>

                            <!-- Rating -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-star mr-2"></i>Đánh giá
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="rating-display">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            if (i <= Model.Rating)
                                            {
                                                <i class="fas fa-star text-warning fa-2x"></i>
                                            }
                                            else
                                            {
                                                <i class="far fa-star text-muted fa-2x"></i>
                                            }
                                        }
                                        <span class="ml-3 h4">@Model.Rating/5 sao</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Comment -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-comment mr-2"></i>Nội dung phản hồi
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="feedback-comment">
                                        @if (!string.IsNullOrEmpty(Model.Comment))
                                        {
                                            <p class="mb-0">@Model.Comment</p>
                                        }
                                        else
                                        {
                                            <p class="text-muted mb-0">Không có nội dung phản hồi</p>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <!-- Quick Actions -->
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-tools mr-2"></i>Hành động nhanh
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <a href="@Url.Action("Reply", new { id = Model.Id })" class="btn btn-primary">
                                            <i class="fas fa-reply"></i> Trả lời phản hồi
                                        </a>
                                        <a href="@Url.Action("Detail", "VehicleSearch", new { id = Model.ProductId })" class="btn btn-info">
                                            <i class="fas fa-car"></i> Xem sản phẩm
                                        </a>
                                        <button type="button" class="btn btn-success" onclick="markAsReplied()">
                                            <i class="fas fa-check"></i> Đánh dấu đã trả lời
                                        </button>
                                        <button type="button" class="btn btn-warning" onclick="printFeedback()">
                                            <i class="fas fa-print"></i> In phản hồi
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Status Information -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-info-circle mr-2"></i>Trạng thái
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Trạng thái:</strong> 
                                        <span class="badge badge-info">Chưa xử lý</span>
                                    </p>
                                    <p><strong>Độ ưu tiên:</strong> 
                                        @if (Model.Rating <= 2)
                                        {
                                            <span class="badge badge-danger">Cao</span>
                                        }
                                        else if (Model.Rating <= 3)
                                        {
                                            <span class="badge badge-warning">Trung bình</span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-success">Thấp</span>
                                        }
                                    </p>
                                    <p><strong>Cập nhật lần cuối:</strong> @Model.UpdatedAt.ToString("dd/MM/yyyy HH:mm")</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function markAsReplied() {
            if (confirm('Bạn có chắc chắn muốn đánh dấu phản hồi này là đã trả lời?')) {
                // Implement mark as replied functionality
                alert('Đã đánh dấu phản hồi là đã trả lời!');
            }
        }

        function printFeedback() {
            var printWindow = window.open('', '_blank');
            var content = `
                <html>
                <head>
                    <title>Phản hồi khách hàng - @Model.CustomerName</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .info-table { width: 100%; border-collapse: collapse; }
                        .info-table td { padding: 8px; border: 1px solid #ddd; }
                        .info-table td:first-child { background-color: #f5f5f5; font-weight: bold; }
                        .rating { color: #ffc107; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>PHẢN HỒI KHÁCH HÀNG</h1>
                    </div>
                    <table class="info-table">
                        <tr><td>Khách hàng:</td><td>@Model.CustomerName</td></tr>
                        <tr><td>Email:</td><td>@Model.CustomerEmail</td></tr>
                        <tr><td>Số điện thoại:</td><td>@Model.CustomerPhone</td></tr>
                        <tr><td>Sản phẩm:</td><td>@Model.ProductName</td></tr>
                        <tr><td>Đánh giá:</td><td class="rating">@Model.Rating/5 sao</td></tr>
                        <tr><td>Ngày gửi:</td><td>@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td></tr>
                        <tr><td>Nội dung:</td><td>@Model.Comment</td></tr>
                    </table>
                </body>
                </html>
            `;
            printWindow.document.write(content);
            printWindow.document.close();
            printWindow.print();
        }
    </script>
}
